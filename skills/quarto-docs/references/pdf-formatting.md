# Quarto Document Formatting Guide

Reference guide for creating publication-quality `.qmd` files.

---

## Documentation Best Practices (IMPORTANT)

Quarto documents intended for publication should be **readable by humans**, not just executable code. Always include prose explanations to help readers understand the analysis.

### Required Structure

Every `.qmd` document should include:

1. **Introduction section** after the YAML header explaining:
   - What the script does (purpose)
   - What data it uses (inputs)
   - What it produces (outputs)
   - Any key context readers need

2. **Section descriptions** — brief prose before each major code section explaining:
   - What this section accomplishes
   - Why it's necessary
   - Any important decisions or assumptions

### Example Structure

```markdown
# Introduction

This script generates volcano plots for the tryptamine phosphoproteomics
time course experiment. It visualizes differential phosphorylation between
tryptamine-treated and DMSO control samples at 3, 15, and 30 minutes.

**Inputs:** Limma results from `datasets_for_plotting/limma_results_annotated.rds`

**Outputs:** PDF volcano plots in `outs/phosphoproteomics_figures/volcano_*/`

# Setup

Load required packages and define paths. We use `here::here()` for
reproducible path handling.

```{r}
#| label: setup
library(tidyverse)
...
```

# Load Data

Read the pre-processed limma results and module annotations. These were
generated by `tryptamine_phosphoproteomics_analysis_cleaned.qmd`.

```{r}
#| label: load-data
...
```
```

### Guidelines

- **Write for a reader unfamiliar with the project** — assume they haven't read other scripts
- **Explain the "why", not just the "what"** — code shows what; prose explains why
- **Keep explanations concise** — 2-4 sentences per section is usually sufficient
- **Use markdown formatting** — bold for emphasis, bullet points for lists
- **Document non-obvious decisions** — why this threshold? why this filter?

---

## Choosing a Format

| Format | Best for | Pros | Cons |
|--------|----------|------|------|
| **HTML** | GitHub publication, web sharing | Reliable text wrapping, interactive features, self-contained | Requires browser to view |
| **PDF** | Print, formal documents | Portable, consistent appearance | LaTeX quirks, line wrapping issues |

**Recommendation:** Use HTML for GitHub/web publication. Use PDF only when print output is required.

---

## HTML Format (Recommended for GitHub)

```yaml
---
title: "Document Title"
subtitle: "Optional subtitle"
author: "Author Name"
date: today
format:
  html:
    toc: true
    toc-depth: 2
    number-sections: true
    code-overflow: wrap
    code-fold: false
    code-tools: true
    highlight-style: github
    theme: cosmo
    fontsize: 1rem
    linestretch: 1.5
    self-contained: true
execute:
  echo: true
  message: false
  warning: false
  cache: false
---
```

### HTML-Specific Options

| Option | Purpose |
|--------|---------|
| `self-contained: true` | Embeds all assets in one HTML file (easy to share) |
| `code-tools: true` | Adds button to show/hide all code |
| `code-fold: false` | Show code by default (`true` hides code behind toggle) |
| `theme: cosmo` | Clean Bootstrap theme (alternatives: `flatly`, `lumen`, `sandstone`) |

### HTML Themes

Good choices for code-heavy documents:
- `cosmo` — clean, modern (recommended)
- `flatly` — flat design, high contrast
- `lumen` — light, spacious
- `sandstone` — warm, readable

---

## PDF Format

```yaml
---
title: "Document Title"
subtitle: "Optional subtitle"
author: "Author Name"
date: today
format:
  pdf:
    toc: true
    toc-depth: 2
    number-sections: true
    code-overflow: wrap
    code-line-numbers: false
    highlight-style: github
    code-block-bg: "#f7f7f7"
    code-block-border-left: "#cccccc"
    documentclass: article
    papersize: letter
    geometry:
      - top=1in
      - bottom=1in
      - left=1in
      - right=1in
    fontsize: 11pt
    colorlinks: true
    linkcolor: NavyBlue
    urlcolor: NavyBlue
    fig-pos: "H"
    include-in-header:
      text: |
        \usepackage{fvextra}
        \DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}
        \usepackage{xurl}
        \sloppy
execute:
  echo: true
  message: false
  warning: false
  cache: false
---
```

### PDF-Specific Options

| Option | Purpose |
|--------|---------|
| `code-block-bg: "#f7f7f7"` | Light gray background for code blocks |
| `code-block-border-left: "#cccccc"` | Subtle left border on code blocks |
| `fig-pos: "H"` | Keeps figures where they're placed in code |
| `include-in-header` | LaTeX packages for proper line wrapping (critical!) |

**Note:** The `include-in-header` section is required for reliable code line wrapping in PDFs. Without it, long lines may run off the page.

---

## Common Options (Both Formats)

| Option | Purpose |
|--------|---------|
| `code-overflow: wrap` | Wraps long code lines |
| `highlight-style: github` | Clean syntax highlighting |
| `toc: true` | Table of contents |
| `number-sections: true` | Numbered section headings |

### Execute Options

```yaml
execute:
  echo: true       # Show code (false to hide)
  message: false   # Hide R messages
  warning: false   # Hide warnings
  cache: false     # Disable caching
```

---

## Highlight Styles

- `github` — clean, minimal (recommended)
- `tango` — colorful, high contrast
- `kate` — balanced colors
- `zenburn` — dark theme
- `monochrome` — grayscale (good for printing)

---

## Minimal Examples

### HTML (quickest setup)

```yaml
format:
  html:
    toc: true
    code-tools: true
    self-contained: true
execute:
  echo: true
  message: false
  warning: false
```

### PDF (quickest setup)

```yaml
format:
  pdf:
    toc: true
    code-overflow: wrap
    highlight-style: github
    include-in-header:
      text: |
        \usepackage{fvextra}
        \DefineVerbatimEnvironment{Highlighting}{Verbatim}{breaklines,commandchars=\\\{\}}
execute:
  echo: true
  message: false
  warning: false
```